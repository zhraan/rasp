<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SortaManggis</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #28a745; /* hijau dasar */
      color: #155724; /* hijau gelap */
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      margin: 0;
      padding: 2rem 0;
      display: flex;
      justify-content: center;
      align-items: start;
      perspective: 1000px;
    }
    .container-content {
      background-color: #ffffff;
      border-radius: 0.75rem;
      padding: 2rem 2.5rem;
      max-width: 900px;
      width: 100%;
      box-shadow:
        0 10px 20px rgba(0, 0, 0, 0.25),
        0 6px 6px rgba(0, 0, 0, 0.22);
      transform-style: preserve-3d;
      transform: translateZ(30px);
      transition: transform 0.3s ease;
    }
    /* .container-content:hover {
      transform: translateZ(50px);
      box-shadow:
        0 20px 40px rgba(0, 0, 0, 0.35),
        0 12px 12px rgba(0, 0, 0, 0.3);
    } */
    .header {
      background-color: #28a745;
      color: white;
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      border-bottom: 1px solid #1e7e34;
      text-align: center;
      font-weight: 500;
      font-size: 1.25rem;
      margin-bottom: 1rem;
      box-shadow: inset 0 -2px 4px rgba(0,0,0,0.15);
    }
    .status-system {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 0.5rem;
      font-size: 1rem;
      color: #155724;
      margin-bottom: 1rem;
    }
    .status-dot {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      display: inline-block;
    }
    .status-red {
      background-color: #dc3545; /* merah */
      box-shadow: 0 0 4px 1px #dc3545;
    }
    .status-green {
      background-color: #28a745; /* hijau */
      box-shadow: 0 0 4px 1px #28a745;
    }
    .real-time {
      font-size: 4rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 1rem;
      color: #155724;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      position: relative;
      top: -28px;
    }
    .btn-date {
      display: block;
      margin: 0 auto 2rem auto;
      background-color: #28a745; /* hijau utama */
      border: 1px solid #1e7e34; /* hijau lebih gelap */
      color: white;
      font-weight: 500;
      border-radius: 0.375rem;
      padding: 0.5rem 1.5rem;
      font-size: 1.1rem;
      cursor: pointer;
      box-shadow: 0 3px 6px rgba(0,0,0,0.16);
      transition: background-color 0.3s ease;
    }

    /* .btn-date:hover {
      background-color: #999999;
    } */
    .title {
      font-size: 3rem;
      font-weight: 500;
      text-align: center;
      margin-bottom: 0.5rem;
      color: #155724;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    .stopwatch {
      font-size: 2.5rem;
      font-weight: 600;
      text-align: center;
      margin-bottom: 2rem;
      color: #155724;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    .card-sortasi {
      background-color: #28a745;
      border-radius: 0.75rem;
      border: none;
      text-align: center;
      margin-bottom: 1rem;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
      padding-top: 0;
      padding-bottom: 1rem;
      color: white;
      position: relative;
      top: -10px;
      transition: box-shadow 0.3s ease;
    }
    .card-sortasi:hover {
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.35);
    }
    .card-header {
      background-color: #1e7e34;
      border-top-left-radius: 0.75rem;
      border-top-right-radius: 0.75rem;
      padding: 0.5rem 0;
      font-weight: 600;
      font-size: 1.1rem;
      color: white;
      box-shadow: inset 0 -2px 4px rgba(0,0,0,0.3);
      margin-bottom: 0.25rem;
    }
    .card-body {
      font-size: 4rem;
      font-weight: 700;
      color: white;
      padding: 0;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
    }
    @media (max-width: 575.98px) {
      .title {
        font-size: 2rem;
      }
      .stopwatch {
        font-size: 1.8rem;
      }
      .card-body {
        font-size: 3rem;
      }
      .btn-date {
        font-size: 1rem;
        padding: 0.4rem 1rem;
      }
      .card-sortasi {
        top: -6px;
      }
      .real-time {
        font-size: 3rem;
        top: -20px;
      }
    }
  </style>
</head>
<body>
  <div class="container-content" role="main" aria-label="Konten utama website SortaManggis">
    <header class="header">
      Sistem Sortasi Manggis
    </header>
    <div class="status-system" aria-live="polite" aria-atomic="true">
      <span class="status-dot status-red" aria-label="Status sistem"></span>
      <span>Status Sistem</span>
    </div>
    <div class="real-time" id="realTime">00:00:00</div>
    <button type="button" class="btn-date" aria-label="Tampilkan hari dan tanggal">Hari dan Tanggal</button>
    <h1 class="title">Durasi Sortasi</h1>
    <div class="stopwatch" id="stopwatch">00:00:00</div>
    <div class="row justify-content-center g-4">
      <div class="col-6 col-sm-3">
        <div class="card-sortasi" tabindex="0" aria-label="Jumlah rusak 0">
          <div class="card-header">Rusak</div>
          <div class="card-body" id="kelas_rusak">0</div>
        </div>
      </div>
      <div class="col-6 col-sm-3">
        <div class="card-sortasi" tabindex="0" aria-label="Jumlah kelas super 0">
          <div class="card-header">Kelas Super</div>
          <div class="card-body" id="kelas_super">0</div>
        </div>
      </div>
      <div class="col-6 col-sm-3">
        <div class="card-sortasi" tabindex="0" aria-label="Jumlah kelas A 0">
          <div class="card-header">Kelas A</div>
          <div class="card-body" id="kelas_a">0</div>
        </div>
      </div>
      <div class="col-6 col-sm-3">
        <div class="card-sortasi" tabindex="0" aria-label="Jumlah kelas B 0">
          <div class="card-header">Kelas B</div>
          <div class="card-body" id="kelas_b">0</div>
        </div>
      </div>
    </div>
    <a href="/riwayat" class="btn btn-outline-success d-block mx-auto mb-1" style="width: fit-content;">
      Lihat Riwayat Sortasi
    </a>
  </div>

  <script>
  function updateRealTimeClock() {
    const now = new Date();
    const h = String(now.getHours()).padStart(2, '0');
    const m = String(now.getMinutes()).padStart(2, '0');
    const s = String(now.getSeconds()).padStart(2, '0');
    document.getElementById('realTime').textContent = `${h}:${m}:${s}`;
  }

  function updateTanggal() {
    const hari = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
    const bulan = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                  'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
    const now = new Date();
    const namaHari = hari[now.getDay()];
    const tanggal = now.getDate();
    const namaBulan = bulan[now.getMonth()];
    const tahun = now.getFullYear();

    const formatTanggal = `${namaHari} / ${tanggal} ${namaBulan} ${tahun}`;
    document.querySelector('.btn-date').textContent = formatTanggal;
  }

  function formatTime(seconds) {
    const h = String(Math.floor(seconds / 3600)).padStart(2, '0');
    const m = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
    const s = String(seconds % 60).padStart(2, '0');
    return `${h}:${m}:${s}`;
  }
    
  let stopwatchSeconds = 0;
  let stopwatchInterval = null;

  function startStopwatch() {
    if (stopwatchInterval) return; // jangan start 2x
    stopwatchInterval = setInterval(() => {
      stopwatchSeconds++;
      document.getElementById('stopwatch').textContent = formatTime(stopwatchSeconds);
    }, 1000);
  }

  function stopStopwatch() {
    clearInterval(stopwatchInterval);
    stopwatchInterval = null;
  }

  function resetStopwatch() {
    stopwatchSeconds = 0;
    document.getElementById('stopwatch').textContent = "00:00:00";
  }

  function fetchSystemStatus() {
    fetch("/api/status")
      .then(res => res.json())
      .then(data => {
        const dot = document.querySelector(".status-dot");
        if (data.running) {
          dot.classList.remove("status-red");
          dot.classList.add("status-green");
          startStopwatch();   // mulai stopwatch
        } else {
          dot.classList.remove("status-green");
          dot.classList.add("status-red");
          stopStopwatch();    // hentikan stopwatch
          resetStopwatch();   // reset ke 00:00:00
        }
      })
      .catch(err => console.error("Status check error:", err));
  }

  // Tambahan: fetch data dari MongoDB via Flask API
  function fetchRealtimeData() {
    fetch("/api/realtime")
      .then(res => res.json())
      .then(data => {
        document.getElementById("kelas_rusak").textContent = data.rusak;
        document.getElementById("kelas_super").textContent = data.kelas_super;
        document.getElementById("kelas_a").textContent = data.kelas_a;
        document.getElementById("kelas_b").textContent = data.kelas_b;
      });
  }

  window.addEventListener('DOMContentLoaded', () => {
    updateRealTimeClock();
    updateTanggal();
    setInterval(updateRealTimeClock, 1000);
    setInterval(fetchRealtimeData, 1000);
    setInterval(fetchSystemStatus, 1000); // cek status setiap 1 detik
    setInterval(updateTanggal, 60000); // update setiap 60 detik
  });

</script>
 

</body>
</html>